#!/usr/bin/env bash

set -e

echo "Running Main App"


# R-syncs files inside an android phone with existing direcroy.
# It takes one argument, the path to sync. This command is supposed to be run from within the sync directory

# @TODO accept 2nd argument for the destination


main() {
  cmd=$(build_command ${@})
  run $cmd
}

get_src_dir() {
  echo /run/user/$UID/gvfs/mtp*
}

build_command() {
  local path_to_sync="$1"
  echo $path_to_sync
  echo "WORK IN PROGRESS"
  echo "Start here: https://stackoverflow.com/questions/5819423/bash-variables-with-spaces"
  echo "We are trying to read cd /_extra/android_sync/data && android-sync 'Card/Voice Recorder'"
  exit 2

  # Default to "."
  path_to_sync=${path_to_sync:-.}
  # Remove trailing slash
  path_to_sync=${path_to_sync%/}
  dir_src=$(get_src_dir)
  cmd="rsync -av $dir_src/$path_to_sync/ $path_to_sync"
  echo $cmd
}

run() {

  local __cmd=${@}

  dir_src=$(get_src_dir)
  cd $dir_src

  [ ! -d "Phone" ] && echo "[ERROR] Phone not mounted. Exiting now." && exit

  echo "[CMD] $__cmd"
  read -p 'yes or --dry-run? y/D' dry_run

  case "$dry_run" in
    "y")
      $__cmd
      ;;
    "*")
      echo "'--dry-running'-ing"
      $__cmd --dry-run
      ;;
  esac
}

[ -z "$IS_TESTING" ] && main ${@}

